<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fluentigo ‚Äî —É—á–∏—Ç–µ–ª—è</title>
  <link rel="stylesheet" href="./styles.css" />

  <style>
    /* ‚úÖ –ö–õ–Æ–ß–ï–í–ê–Ø –ü–†–ê–í–ö–ê: hidden —Ç–µ–ø–µ—Ä—å —Ä–µ–∞–ª—å–Ω–æ –ø—Ä—è—á–µ—Ç –º–æ–¥–∞–ª–∫—É */
    .modal-backdrop[hidden]{ display:none !important; }

    .modal-backdrop{
      position: fixed;
      inset: 0;
      background: rgba(11,18,32,.45);
      display: grid;
      place-items: center;
      padding: 18px;
      z-index: 9999;
    }
    .modal{
      width: min(560px, 100%);
      border-radius: 18px;
      border: 1px solid rgba(11,18,32,.10);
      background: rgba(255,255,255,.98);
      box-shadow: 0 22px 60px rgba(0,0,0,.25);
      padding: 18px;
    }
    .modal-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 10px;
    }
    .modal-top h2{ margin:0; }
    .modal-actions{
      display:flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    .icon-btn{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 12px 14px;
      border-radius: 16px;
      border: 1px solid rgba(11,18,32,.12);
      background: rgba(234,246,255,.60);
      cursor:pointer;
      font-weight: 900;
    }
    .icon-btn:hover{ background: rgba(234,246,255,.95); }
    .icon{ width: 22px; height: 22px; display:block; }

    .success{
      display:flex;
      align-items:flex-start;
      gap:12px;
      margin-top: 6px;
    }
    .success-badge{
      width: 40px;
      height: 40px;
      border-radius: 14px;
      display:grid;
      place-items:center;
      border: 1px solid rgba(11,18,32,.12);
      background: rgba(45,124,196,.16);
      flex: 0 0 auto;
    }
    .success-badge svg{ width:22px; height:22px; }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="container topbar-row">
      <a class="brand" href="./index.html" aria-label="Fluentigo">
        <span class="brand-dot"></span>
        <span class="brand-name" id="siteName">Fluentigo</span>
      </a>

      <nav class="nav" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
        <a id="backToLang" href="./index.html#languages" data-i18n="nav_back">–ù–∞–∑–∞–¥</a>
        <a href="./index.html#about" data-i18n="nav_about">–ö—Ç–æ –º—ã?</a>
        <a href="./index.html#pricing" data-i18n="nav_pricing">–†–∞—Å—Ü–µ–Ω–∫–∏</a>
        <a href="./index.html#contact" data-i18n="nav_contact">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
      </nav>
      <div class="ui-switch" aria-label="–í—ã–±–æ—Ä —è–∑—ã–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞">
        <button class="ui-pill" id="uiRu" type="button" aria-pressed="true" title="–†—É—Å—Å–∫–∏–π">
          <span class="flag-mini"><img src="./assets/flags/ru.svg" alt="RU"></span><span>RU</span>
        </button>
        <button class="ui-pill" id="uiUa" type="button" aria-pressed="false" title="–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞">
          <span class="flag-mini"><img src="./assets/flags/ua.svg" alt="UA"></span><span>UA</span>
        </button>
      </div>
    </div>
  </header>

  <main class="section">
    <div class="container">
      <div class="panel lang-header">
        <div class="lang-title">
          <div class="lang-flag big" id="langFlag">üè≥Ô∏è</div>
          <div>
            <h1 class="lang-h1" id="pageTitle">–£—á–∏—Ç–µ–ª—è</h1>
            <p class="muted" id="pageSubtitle"></p>
          </div>
        </div>
        <a class="btn btn-ghost" id="backBtn" href="./index.html#languages">‚Üê –ù–∞–∑–∞–¥</a>
      </div>

      <div class="panel">
        <div class="teachers-head">
          <h2 id="teachersTitle">–ü–æ–¥–±–æ—Ä —É—á–∏—Ç–µ–ª–µ–π</h2>
          <button class="btn btn-ghost" id="rerollBtn" type="button">–ü–æ–∫–∞–∑–∞—Ç—å –¥—Ä—É–≥–∏—Ö</button>
        </div>

        <div class="teacher-grid" id="teacherGrid"></div>
        <p class="muted tiny" id="hint"></p>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container footer-row">
      <div>
        <div class="muted" id="footerText"></div>
        <div class="footer-contacts" id="footerContacts"></div>
      </div>
      <span class="muted tiny">Fluentigo ‚Äî Language School</span>
    </div>
  </footer>

  <!-- ‚úÖ –ú–û–î–ê–õ–ö–ê –ò–ó–ù–ê–ß–ê–õ–¨–ù–û –°–ö–†–´–¢–ê -->
  <div id="modalBackdrop" class="modal-backdrop" hidden>
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-top">
        <h2 id="modalTitle">–°–≤—è–∑–∞—Ç—å—Å—è</h2>
        <button class="btn btn-ghost" id="modalClose" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>
      <p class="muted" id="modalText"></p>
      <div class="modal-actions" id="modalActions"></div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    function el(tag, attrs = {}, children = []) {
      const n = document.createElement(tag);
      for (const [k, v] of Object.entries(attrs)) {
        if (k === 'class') n.className = v;
        else n.setAttribute(k, v);
      }
      for (const c of children) n.appendChild(typeof c === 'string' ? document.createTextNode(c) : c);
      return n;
    }

    function applyTheme(theme) {
      const r = document.documentElement;
      r.style.setProperty('--page-bg', theme.pageBg);
      r.style.setProperty('--text', theme.text);
      r.style.setProperty('--panel-bg', theme.panelBg);
      r.style.setProperty('--topbar-bg', theme.topbarBg);
      r.style.setProperty('--topbar-text', theme.topbarText);
    }

    function renderFooter(data) {
      $('footerText').textContent = data.site.footerText;
      const fc = $('footerContacts');
      fc.innerHTML = '';
      (data.contact.items || []).forEach(i => {
        fc.appendChild(el('span', { class: 'footer-link' }, [`${i.label}: ${i.value}`]));
      });
      (data.contact.links || []).forEach(l => { fc.appendChild(makeSocialIcon(l, true)); });
    }

    function qp(name){ return new URL(location.href).searchParams.get(name); }

    function shuffle(arr){
      const a = [...arr];
      for (let i=a.length-1; i>0; i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    const ICONS = {
      whatsapp: `
        <svg class="icon" viewBox="0 0 32 32" aria-hidden="true">
          <path fill="#25D366" d="M16 3C9.4 3 4 8.3 4 14.9c0 2.4.7 4.7 2 6.7L5 29l7.6-1.9c1.9 1 3.9 1.5 5.9 1.5 6.6 0 12-5.4 12-12C30.5 8.3 22.6 3 16 3z"/>
          <path fill="#fff" d="M12.6 9.7c-.3-.6-.6-.6-.9-.6h-.7c-.2 0-.6.1-.9.5-.3.4-1.1 1.1-1.1 2.8 0 1.6 1.2 3.2 1.4 3.4.2.2 2.3 3.6 5.6 4.9 2.7 1.1 3.3.9 3.9.8.6-.1 1.9-.8 2.2-1.6.3-.8.3-1.4.2-1.6-.1-.2-.3-.3-.6-.5-.3-.2-1.9-.9-2.2-1-.3-.1-.5-.2-.7.2-.2.4-.8 1-.9 1.2-.2.2-.3.2-.6.1-.3-.2-1.2-.4-2.3-1.4-.9-.8-1.5-1.8-1.7-2.1-.2-.3 0-.5.1-.6.1-.1.3-.3.4-.5.1-.2.2-.3.3-.5.1-.2 0-.4-.1-.6-.1-.2-.7-1.8-1-2.4z"/>
        </svg>`,
      facebook: `
        <svg class="icon" viewBox="0 0 32 32" aria-hidden="true">
          <path fill="#1877F2" d="M16 3C8.8 3 3 8.8 3 16s5.8 13 13 13 13-5.8 13-13S23.2 3 16 3z"/>
          <path fill="#fff" d="M18 26v-8h2.7l.4-3H18v-1.9c0-.9.2-1.5 1.5-1.5h1.6V8.1c-.3 0-1.3-.1-2.5-.1-2.5 0-4.2 1.5-4.2 4.3V15h-2.7v3h2.7v8H18z"/>
        </svg>`
    };


    function inferIconKey(link){
      const label = (link.label || '').toLowerCase();
      const url = (link.url || '').toLowerCase();
      if (url.startsWith('mailto:') || label.includes('email')) return 'email';
      if (label.includes('whatsapp')) return 'whatsapp';
      if (label.includes('telegram')) return 'telegram';
      if (label.includes('instagram')) return 'instagram';
      if (label.includes('facebook')) return 'facebook';
      return 'email';
    }
    function makeSocialIcon(link, isFooter=false){
      const key = inferIconKey(link);
      const a = el('a', {
        class: isFooter ? 'footer-link social-icon' : 'social-icon',
        href: link.url,
        target: '_blank',
        rel: 'noopener',
        title: link.label
      });
      a.innerHTML = ICONS[key] + `<span>${link.label}</span>`;
      return a;
    }

    function qp(name){ return new URL(location.href).searchParams.get(name); }
    function getUI(){ return qp('ui') || localStorage.getItem('ui') || 'ru'; }
    function setUI(ui){
      localStorage.setItem('ui', ui);
      $('uiRu').setAttribute('aria-pressed', ui==='ru' ? 'true':'false');
      $('uiUa').setAttribute('aria-pressed', ui==='ua' ? 'true':'false');
      document.documentElement.lang = ui==='ua' ? 'uk' : 'ru';
      const I={
        ru:{nav_back:'–ù–∞–∑–∞–¥',nav_about:'–ö—Ç–æ –º—ã?',nav_pricing:'–†–∞—Å—Ü–µ–Ω–∫–∏',nav_contact:'–ö–æ–Ω—Ç–∞–∫—Ç—ã',
            reroll:'–ü–æ–∫–∞–∑–∞—Ç—å –¥—Ä—É–≥–∏—Ö',title:'–£—á–∏—Ç–µ–ª—è',pick:'–ü–æ–¥–±–æ—Ä —É—á–∏—Ç–µ–ª–µ–π'},
        ua:{nav_back:'–ù–∞–∑–∞–¥',nav_about:'–•—Ç–æ –º–∏?',nav_pricing:'–¶—ñ–Ω–∏',nav_contact:'–ö–æ–Ω—Ç–∞–∫—Ç–∏',
            reroll:'–ü–æ–∫–∞–∑–∞—Ç–∏ —ñ–Ω—à–∏—Ö',title:'–í—á–∏—Ç–µ–ª—ñ',pick:'–ü—ñ–¥–±—ñ—Ä –≤—á–∏—Ç–µ–ª—ñ–≤'}
      };
      document.querySelectorAll('[data-i18n]').forEach(n=>{
        const k=n.getAttribute('data-i18n');
        if(I[ui] && I[ui][k]) n.textContent=I[ui][k];
      });
      const r = document.getElementById('rerollBtn');
      if (r) r.textContent = I[ui]?.reroll || r.textContent;
    }

    const LEVEL_ORDER = ['A1','A2','B1','B2','C1','C2'];
    function parseLevelRange(str){
      const s = (str || '').toUpperCase();
      const m = s.match(/(A1|A2|B1|B2|C1|C2)\s*[‚Äì-]\s*(A1|A2|B1|B2|C1|C2)/);
      if (!m) return null;
      return {min:m[1], max:m[2]};
    }
    function teacherMatchesLevel(t, level){
      if (!level) return true;
      if (Array.isArray(t.levels)) return t.levels.includes(level);
      const range = parseLevelRange(t.role || t.subtitle || '');
      if (!range) return true;
      const i = LEVEL_ORDER.indexOf(level);
      const a = LEVEL_ORDER.indexOf(range.min);
      const b = LEVEL_ORDER.indexOf(range.max);
      if (i<0 || a<0 || b<0) return true;
      return i>=a && i<=b;
    }


    let DATA = null;
    let LANG = null;
    let GOAL = null;
    let selectedTeacher = '';

    function openModal(){ $('modalBackdrop').hidden = false; }
    function closeModal(){ $('modalBackdrop').hidden = true; }

    function findLink(labelIncludes){
      return (DATA?.contact?.links || []).find(x => (x.label || '').toLowerCase().includes(labelIncludes));
    }

    function modalChoose(){
      $('modalTitle').textContent = getUI()==='ua' ? '–ó–≤ º—è–∑–∞—Ç–∏—Å—è' : '–°–≤—è–∑–∞—Ç—å—Å—è';
      $('modalText').textContent = `${getUI()==='ua' ? '–í–∏ –æ–±—Ä–∞–ª–∏ –≤–∏–∫–ª–∞–¥–∞—á–∞' : '–í—ã –≤—ã–±—Ä–∞–ª–∏ —É—á–∏—Ç–µ–ª—è'}: ${selectedTeacher}. ${getUI()==='ua' ? '–Ø–∫ –∑—Ä—É—á–Ω–æ –∑–≤ º—è–∑–∞—Ç–∏—Å—è?' : '–ö–∞–∫ —É–¥–æ–±–Ω–æ —Å–≤—è–∑–∞—Ç—å—Å—è?'}`;

      const actions = $('modalActions');
      actions.innerHTML = '';

      const links = (DATA?.contact?.links || []);
      const order = [
        {k:'whatsapp', label:'WhatsApp'},
        {k:'telegram', label:'Telegram'},
        {k:'instagram', label:'Instagram'},
        {k:'facebook', label:'Facebook'},
        {k:'email', label:'Email'}
      ];

      order.forEach(o=>{
        const l = links.find(x => inferIconKey(x)===o.k);
        if (!l) return;
        const btn = el('button', { class:'icon-btn', type:'button' });
        btn.innerHTML = ICONS[o.k] + `<span>${o.label}</span>`;
        btn.addEventListener('click', ()=> modalSuccess(o.label, l.url));
        actions.appendChild(btn);
      });

      const cancelBtn = el('button', { class: 'btn btn-ghost', type: 'button' }, [getUI()==='ua' ? '–°–∫–∞—Å—É–≤–∞—Ç–∏' : '–û—Ç–º–µ–Ω–∞']);
      cancelBtn.addEventListener('click', closeModal);
      actions.appendChild(cancelBtn);

      openModal();
    }

    function modalSuccess(method, url){
      $('modalTitle').textContent = '–í—Å—ë –æ—Ç–ª–∏—á–Ω–æ!';
      $('modalText').innerHTML = `
        <div class="success">
          <div class="success-badge" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <path fill="currentColor" d="M9.2 16.6 4.9 12.3l1.4-1.4 2.9 2.9 8.5-8.5 1.4 1.4z"/>
            </svg>
          </div>
          <div>
            <div style="font-weight:900; margin-bottom:6px;">–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è.</div>
            <div class="muted">–ö–∞–Ω–∞–ª: ${method}. –°–ø–∞—Å–∏–±–æ!</div>
          </div>
        </div>
      `;

      const actions = $('modalActions');
      actions.innerHTML = '';

      if (url && url !== '#') {
        actions.appendChild(el('a', { class: 'btn', href: url, target: '_blank', rel: 'noopener' }, ['–û—Ç–∫—Ä—ã—Ç—å ' + method]));
      }

      const okBtn = el('button', { class: 'btn btn-ghost', type: 'button' }, ['–ó–∞–∫—Ä—ã—Ç—å']);
      okBtn.addEventListener('click', closeModal);
      actions.appendChild(okBtn);
    }

    function renderTeachers(){
      const goalObj = LANG.goals.find(g => g.id === GOAL);
      const pool = (LANG.teachers || []).filter(t => (t.goals || []).includes(GOAL));
      const five = shuffle(pool).slice(0, 5);

      $('langFlag').textContent = LANG.flag;
      $('pageTitle').textContent = `–£—á–∏—Ç–µ–ª—è ‚Äî ${LANG.name}`;
      $('pageSubtitle').textContent = goalObj ? goalObj.title : '';

      $('teachersTitle').textContent = `–£—á–∏—Ç–µ–ª—è ‚Äî ${LANG.name} ‚Ä¢ ${goalObj ? goalObj.title : ''}`;
      $('hint').textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ 5 —Å–ª—É—á–∞–π–Ω—ã—Ö –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π –ø–æ–¥ —Ü–µ–ª—å: ${goalObj ? goalObj.title : ''}.`;

      const grid = $('teacherGrid');
      grid.innerHTML = '';

      five.forEach(t => {
        const chooseBtn = el('button', { class: 'btn', type: 'button' }, ['–í—ã–±—Ä–∞—Ç—å']);
        chooseBtn.addEventListener('click', () => {
          selectedTeacher = t.name;
          modalChoose();   // ‚úÖ –º–æ–¥–∞–ª–∫–∞ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞
        });

        grid.appendChild(
          el('article', { class: 'teacher-card' }, [
            el('div', { class: 'teacher-top' }, [
              el('div', { class: 'avatar' }, [t.initials]),
              el('div', {}, [
                el('div', { class: 'teacher-name' }, [t.name]),
                el('div', { class: 'muted tiny' }, [t.role])
              ])
            ]),
            el('p', { class: 'text' }, [t.bio]),
            el('ul', { class: 'meta' }, [
              el('li', {}, [`–û–ø—ã—Ç: ${t.experienceYears} –ª–µ—Ç`]),
              el('li', {}, [`–§–æ–∫—É—Å: ${t.focus.join(', ')}`]),
              el('li', {}, [`–§–æ—Ä–º–∞—Ç: ${t.format}`])
            ]),
            el('div', { style: 'margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;' }, [chooseBtn])
          ])
        );
      });
    }

    (async function init(){
      const res = await fetch('./data.json', { cache: 'no-store' });
      DATA = await res.json();

      $('siteName').textContent = DATA.site.name;
      renderFooter(DATA);

      const langId = qp('lang');
      GOAL = qp('goal');
      LANG = DATA.languages.find(x => x.id === langId);

      if (!LANG || !GOAL) {
        applyTheme(DATA.site.defaultTheme);
        $('teachersTitle').textContent = '–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Å—ã–ª–∫–∞';
        $('hint').textContent = '–í–µ—Ä–Ω–∏—Ç–µ—Å—å –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫/—Ü–µ–ª—å –∑–∞–Ω–æ–≤–æ.';
        return;
      }

      applyTheme(LANG.theme);
      document.title = `${DATA.site.name} ‚Äî ${LANG.name}`;

      $('backBtn').href = `./language.html?lang=${encodeURIComponent(LANG.id)}`;
      $('backToLang').href = `./language.html?lang=${encodeURIComponent(LANG.id)}`;

      // ‚úÖ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –Ω–∞ –≤—Ö–æ–¥–µ
      closeModal();

      renderTeachers();
      $('rerollBtn').addEventListener('click', renderTeachers);

      $('modalClose').addEventListener('click', closeModal);
      $('modalBackdrop').addEventListener('click', (e) => {
        if (e.target === $('modalBackdrop')) closeModal();
      });

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeModal();
      });
    })().catch(console.error);
  </script>
</body>
</html>
